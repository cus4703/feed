# :loudspeaker: JPA 영속성이란?

## 영속성 컨텍스트란?
- Entity가 1차 캐시 메모리에 저장되는 공간 (논리적인 개념)

## Entity Manager란?
- 영속성 컨텍스트 안에 담긴 Entity를 관리하는 기능

### 영속성의 상태의 종류
- 비영속 : Entity 가 영속성 컨텍스트에 등록되어 있지 않는 상태   
- 영속 : Entity 가 영속성 컨텍스트에 등록되어 있는 상태 (기능을 제공받을 수 있음)   
  - persist(Entity) 를 하게 되면 영속상태가 된다.
- 준영속 : 영속 상태인 Entity 가 영속성 컨텍스트에서 제거 된 상태
    - 준영속상태로 만드는법
        - detach(Entity) : Entity Manager 에서 해당 객체를 분리   
        - clear() : Entity Manager 를 초기화
        - close() : Entity Manager 닫기
    
### 영속화 되었을 경우 Entity Manager를 통해 제공받을수 있는 기능
- 1차 캐싱 지원
    - Entity 의 조회가 필요한 상황에서 영속성 컨텍스트에 등록되어있는 Entity 는 DB와 통신 없이 바로 제공받을 수 있다.(동일한 객체 주소값을 가지고 있음)   
- 트랜잭션 지원
    - Entity 의 추가, 수정, 삭제 등의 동작이 일어났을 때, 그때마다 DB와 통신하는 것이 아니라 동작에 해당하는 쿼리문을 만들어 쿼리 저장소에 저장해놓는다. 후에 flush()가 일어나게 되면 저장해놓은 쿼리문들을 DB에 적용한다.
        - flush() : 모아둔 쿼리들을 일괄적으로 DB에 보내주는 기능
- 상태변화감지
    - Entity 의 데이터 변화가 일어나면 자동으로 감지하여 해당하는 쿼리문을 작성해서 쿼리문 저장소에 저장한다.
- 지연로딩 지원
    - 필요한 객체의 정보만을 조회할 수 있도록 지원한다.
        - 예를 들어 회원 Entity 안에 팀의 객체가 있다면 회원을 조회할때 팀의 정보도 함께 조회해오는 것이 아니라   
          프록시 객체로 빈 팀의 객체를 가지고 있다가 해당 팀 객체의 데이터를 이용할때 그때 조회해온다.
          ``` java
          // 멤버 Entity안에 Team이라는 객체가 담겨져있다는 가정
          // 현재 상태는 memeber 안에 Team은 프록시 객체로 빈 값으로 존재한다.
          Member member = repository.findById(memberId);
          // 멤버 Entity안에 있는 팀의 프록시 객체의 데이터를 검색하게 된다면 이때 DB에서 데이터를 조회한다. 
          member.getTeam().getName();
          ```
        - 회원 Entity 안에 팀의 Entity 를 즉시로딩으로 설정해두었다면 회원을 조회할때 같이 팀의 데이터도 조회해온다.



